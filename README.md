# Тестовое задание на Bitrix

Это результат выполнения [тестового задания на Bitrix](https://docs.google.com/document/d/1HT-MRjxInzPmgaQTCMHc5oIjlo0qKV6EcQOQnAPji20) для вакансии PHP-разработчика.

## Постановка задания
В компании предусмотрена возможность выбора служебного автомобиля для служебной поездки на определенное время из не занятых другими сотрудниками. В служебной части корпоративного сайта необходимо будет размещать актуальную информацию о доступных для конкретного сотрудника автомобилях на запланированное время поездки.
Дополнительные условия:
- каждая модель автомобиля имеет определенную категорию комфорта (первая, вторая, третья...);
- для определенной должности сотрудников доступны только автомобили определенной категории комфорта (одной или нескольких категорий);
- за каждым автомобилем закреплён свой водитель.


### Часть 1
Спроектировать структуру административного раздела управления контентом (инфоблоки/хайлоадблоки, их свойства и связи), составить в любом редакторе (с возможностью экспорта в  jpg, png, pdf или просмотра в браузере) диаграмму связей.

#### Результат:

![Схема](/task.drawio.png)

### Часть 2
Написать компонент, который выводит для текущего сотрудника список свободных автомобилей на запрошенное время (запрошенное время начала и время окончания поездки передается от клиента на сервер в get-параметрах) с указанием модели, категории комфорта, водителя - шаблон с html-разметкой (template.php) делать не нужно.

#### Результат:

##### Компонент

Мною был написан компонент `task:cars`, получающий список свободных автомобилей на данный временной промежуток для указанного пользователя.

##### Эндпоинты

Для взаимодействия с этим компонентом был написан эндпоинт **GET** `/api/v1/cars/`, принимающий параметры:
* `begin_time` — время начала поездки,
* `end_time` — время окончания поездки.

В ответ эндпоинт присылает:
* успешность выполнения (`success`: `true` или `false`);
* данные:
    * сообщение в случае ошибки (`message`: строка),
    * объект с данными в случае успеха (`data`: объект).

Эндпоинт присылает данные для текущего авторизованного пользователя, от чего зависят доступные классы комфорта.

Для авторизации со стороны API был написан вспомогательный эндпоинт **POST** `/api/v1/auth/`, принимающий параметры:
* `login` — логин,
* `password` — пароль.

В ответ эндпоинт присылает:
* успешность выполнения (`success`: `true` или `false`);
* данные:
    * сообщение в случае ошибки (`message`: строка),
    * объект с id пользователя в случае успеха (`data`: {`user_id`: строка}).

Эндпоинт устанавливает куки для авторизации при последующих запросах.

## Детали реализации

Проект задействует СУБД MariaDB и веб-сервер Apache. Образ проекта был разделён на:
* дамп эталонной БД Bitrix (`/db/bitrix.sql`)
* конфиги СУБД, Apache и PHP (`/config`)
* файлы сайта (`/web`)

Этот репозиторий не включает в себя файлы ядра Bitrix (опущена папка `/web/bitrix`).

### Docker

Для СУБД я использую контейнер `mariadb` с разворачиванием из дампа БД.

Для веб-сервера и самого сайта я взял за основу контейнер `php:8.3-apache` и написал Dockerfile, дбавляющий к нему конфигурацию и файлы сайта; я залил получившийся образ в Docker Hub, чтобы можно было развернуть сайт где угодно без передачи лишних 800 МБ файлов ядра Bitrix через этот репозиторий — образ называется `wynneve/bitrix-web:latest`.

Для разворачивания достаточно клонировать этот репозиторий и поднять его с помощью Docker Compose, перейдя в корень:
```
> git clone https://github.com/Wynneve/bitrix-task
> cd bitrix-task
> docker-compose up -d
```

## Демонстрация

На момент написания я развернул сайт из контейнеров на своём сервере, чтобы можно было проверить работу без разворачивания контейнеров самостоятельно:
* http://92.42.96.77 — адрес сайта (логин и пароль админа Bitrix: `admin`:`0987654321`)

Я создал коллекцию в Postman для демонстрации запросов к эндпоинтам, параметр Host установлен на `92.42.96.77` по тем же причинам:
* https://www.postman.com/wynneve/workspace/demo/collection/23991174-99751386-716d-4764-81bc-0a051a4cb544?action=share&creator=23991174 — адрес коллекции